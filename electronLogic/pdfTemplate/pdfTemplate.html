<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Preventivo</title>
    <!-- inlined by ipc -->
    <link rel="stylesheet" type="text/css" href="file://{{cssPath}}">
</head>

<body>
    <div class="page">

        <!-- ===== Header ===== -->
        <header class="header">
            <div class="identity">
                <img class="logo" src="{{logoDataUrl}}" alt="Logo Carrozzeria" />
                <div class="brand">
                    <h1 class="brand-name">CARROZZERIA TEAM</h1>
                    <p class="brand-meta">
                        Osteria del Bagno 14 · 47922 Rimini (RN)<br />
                        339 223 39 41 · <a href="mailto:info@carrozzeriateam.it">info@carrozzeriateam.it</a><br />
                        P.I. 02005990409
                    </p>
                </div>
            </div>

            <div class="doc-info">
                <div class="doc-title">PREVENTIVO</div>
                <div class="meta-grid">
                    <div class="meta-line"><span class="meta-label">Cliente</span><span
                            class="meta-value">{{client}}</span></div>
                    <div class="meta-line"><span class="meta-label">Assicurazione</span><span
                            class="meta-value">{{insurance}}</span></div>
                    <div class="meta-line"><span class="meta-label">Data preventivo</span><span
                            class="meta-value">{{quoteDate}}</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- ===== Vehicle ===== -->
        <section class="panel">

            <div class="card">
                <div class="card-title">Dati veicolo</div>
                <div class="kv-grid">
                    <div class="kv-row">
                        <div class="kv-label">Targa</div>
                        <div class="kv-pill"><span class="pill">{{licensePlate}}</span></div>
                    </div>
                    <div class="kv-row">
                        <div class="kv-label">Modello</div>
                        <div class="kv-pill"><span class="pill">{{model}}</span></div>
                    </div>
                    <div class="kv-row">
                        <div class="kv-label">Anno</div>
                        <div class="kv-pill"><span class="pill">{{year}}</span></div>
                    </div>
                    <div class="kv-row">
                        <div class="kv-label">Telaio</div>
                        <div class="kv-pill"><span class="pill">{{chassis}}</span></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===== Items ===== -->
        <section class="panel">
            <div class="table-card">
                <div class="table-head">
                    <div>Citaz. fonte</div>
                    <div>Descrizione</div>
                    <div>SR</div>
                    <div>LA</div>
                    <div>VE</div>
                    <div>ME</div>
                    <div>Q.tà</div>
                    <div>Prezzo</div>
                    <div>Totale</div>
                </div>

                <table class="items">
                    <colgroup>
                        <col class="col-fonte" />
                        <col class="col-descrizione" />
                        <col class="col-code" />
                        <col class="col-code" />
                        <col class="col-code" />
                        <col class="col-code" />
                        <col class="col-qty" />
                        <col class="col-price" />
                        <col class="col-total" />
                    </colgroup>
                    <tbody>
                        {{items}}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ===== Riepilogo lavorazioni ===== -->
        <section class="section">
            <div class="grid-head">
                <div class="gh-spacer"></div>
                <div class="gh">Ore</div>
                <div class="gh">Prezzo</div>
                <div class="gh">IVA %</div>
                <div class="gh">Totale</div>
                <div class="gh">Imponibile</div>
                <div class="gh">Imposta</div>
                <div class="gh">Totale IVA inclusa</div>
            </div>

            <!-- Rows are built from JSON; HTML owns all markup/styling -->
            <div class="row-list" id="work-rows"></div>

            <!-- JSON only; the HTML below renders it -->
            <script id="complementary-json" type="application/json">{{complementary_json}}</script>
            <script>
                (function () {
                    function m(n) { n = Number(n); return Number.isFinite(n) ? n.toFixed(2) : ""; }
                    function h(n) { n = Number(n); if (!Number.isFinite(n)) return ""; return (Math.round(n * 100) / 100).toString(); }
                    function pill(v, suffix) {
                        var outer = document.createElement('div');
                        outer.className = 'pill-wrap';
                        var p = document.createElement('span'); p.className = 'pill'; p.textContent = v ?? '';
                        outer.appendChild(p);
                        if (suffix) {
                            var s = document.createElement('span'); s.className = 'pill-suffix'; s.textContent = suffix;
                            outer.appendChild(s);
                        }
                        return outer;
                    }
                    // Columns order must match the header exactly:
                    // [Label] [Ore] [Prezzo] [IVA %] [Totale] [Imponibile] [Imposta] [Totale IVA inclusa]
                    function row(label, qta, prezzo, iva, totale, imponibile, imposta, totaleIvato) {
                        var r = document.createElement('div'); r.className = 'row-card';
                        var name = document.createElement('div'); name.className = 'row-name'; name.textContent = label ?? '';
                        r.appendChild(name);                                  // label
                        r.appendChild(pill(h(qta)));                          // Ore (hours) - plain number
                        r.appendChild(pill(m(prezzo), '€'));                  // Prezzo
                        r.appendChild(pill(h(iva)));                          // IVA %
                        r.appendChild(pill(m(totale), '€'));                  // Totale
                        r.appendChild(pill(m(imponibile), '€'));              // Imponibile
                        r.appendChild(pill(m(imposta), '€'));                 // Imposta
                        r.appendChild(pill(m(totaleIvato), '€'));             // Totale IVA inclusa
                        return r;
                    }

                    var raw = document.getElementById('complementary-json')?.textContent || "{}";
                    var data; try { data = JSON.parse(raw) } catch { data = {} };

                    var out = document.getElementById('work-rows');

                    function safe(o) { return o && typeof o === 'object' ? o : null; }
                    // expected shape: each object has keys:
                    // quantity (hours), price, vat (percent), total, taxable, tax, totalWithTax
                    var lines = [
                        ["Totale Ricambi", safe(data.partsSummary)],
                        ["Voci complementari", safe(data.parts)],
                        ["Manodopera Carrozzeria", safe(data.bodywork)],
                        ["Manodopera Meccanica", safe(data.mechanics)],
                        ["Materiale di consumo", safe(data.consumables)]
                    ];

                    lines.forEach(function ([label, o]) {
                        if (!o) return;
                        out.appendChild(row(
                            label,
                            o.quantity,    // Ore
                            o.price,       // Prezzo
                            o.vat,         // IVA %
                            o.total,       // Totale
                            o.taxable,     // Imponibile
                            o.tax,         // Imposta
                            o.totalWithTax // Totale IVA inclusa
                        ));
                    });
                }());
            </script>
        </section>


        <!-- ===== Totals ===== -->
        <section class="section totals">
            <div class="row-card totals-row">
                <div class="row-name">Totale senza IVA</div>
                <div class="pill-wrap"><span class="pill">{{subtotal}}</span><span class="pill-suffix">€</span></div>
            </div>
            <div class="row-card totals-row">
                <div class="row-name">Totale IVA</div>
                <div class="pill-wrap"><span class="pill">{{iva}}</span><span class="pill-suffix">€</span></div>
            </div>
            <div class="row-card totals-row highlight">
                <div class="row-name">Totale IVA inclusa</div>
                <div class="pill-wrap"><span class="pill">{{totalWithIva}}</span><span class="pill-suffix">€</span>
                </div>
            </div>
        </section>

        <!-- ===== Footer ===== -->
        <footer class="footer">
            <div class="notes">
                <p>Il preventivo ha una validità di 30 giorni; dopo tale data potrebbe subire variazioni.</p>
                <p>I valori del documento sono espressi in EURO.</p>
            </div>
            <div class="privacy">
                <p>
                    Ai sensi dell'art. 13 del Regolamento europeo 679/2016 desideriamo informarla che i dati da Lei
                    forniti
                    formeranno oggetto di trattamento unicamente ai fini dello svolgimento del rapporto commerciale tra
                    noi
                    intercorrente e/o ai fini dell'adempimento degli obblighi contabili e fiscali, nel pieno rispetto
                    delle norme
                    di cui alla legge indicata, rispettando i principi di liceità e correttezza, garantendole comunque
                    il pieno
                    esercizio dei Suoi diritti.
                </p>
            </div>
            <div class="footer-line"></div>
            <div class="page-hint">Preventivo · Carrozzeria Team</div>
        </footer>

    </div>
</body>

</html>